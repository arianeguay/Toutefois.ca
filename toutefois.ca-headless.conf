# /etc/nginx/sites-available/toutefois.ca
# This configuration is for a headless setup.
# It serves a static frontend from /var/www/frontend
# and the WordPress backend from the /backend/ path.

server {
    listen 80;
    server_name 137.184.170.66 toutefois.ca www.toutefois.ca toutefois.arianeguay.ca;

    # --- Frontend Configuration ---
    # Serves the static React application.
    root /var/www/frontend;
    index index.html index.htm;

    # Route all non-file requests to the React app's entry point.
    location / {
        try_files $uri $uri/ /index.html;
    }

    # --- Backend (WordPress) Configuration ---
    # Routes requests to /backend/ to the WordPress installation.
    location /backend/ {
        alias /var/www/html/;
        index index.php;

        # Handle WordPress permalinks under the /backend/ path.
        if (!-e $request_filename) {
            rewrite ^/backend/(.*)$ /backend/index.php?q=$1 last;
        }

        # Process PHP files for WordPress.
        location ~ \.php$ {
            include snippets/fastcgi-php.conf;
            # Check your PHP version and update the socket path if necessary.
            fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
            fastcgi_param SCRIPT_FILENAME $request_filename;
            include fastcgi_params;
        }
    }

    # Deny access to sensitive files like .htaccess.
    location ~ /\.ht {
        deny all;
    }
}
