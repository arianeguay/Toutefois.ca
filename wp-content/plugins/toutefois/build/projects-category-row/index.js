(()=>{"use strict";const e=window.wp.blocks,t=window.React,o=window.wp.blockEditor,r=window.wp.components,s=window.wp.data,i=window.wp.element,n=window.wp.i18n,a="projet",l="category",d=(e,t)=>`${"— ".repeat(t)}${e}`,c=JSON.parse('{"UU":"toutefois/projects-category-row"}');(0,e.registerBlockType)(c.UU,{edit:function({attributes:e,setAttributes:c}){const{category:u,title:p}=e,[m,g]=(0,i.useState)(!0),y=(0,i.useMemo)(()=>{const e=Number(u);return Number.isFinite(e)&&e>0?e:null},[u]),{terms:f,termsIsResolving:_,termsError:w}=(0,s.useSelect)(e=>{var t;const o=e("core"),r={per_page:-1,_fields:"id,name,parent,slug",context:"view"},s=e("core/data").isResolving("core","getEntityRecords",["taxonomy",l,r]);return{terms:o.getEntityRecords("taxonomy",l,r),termsIsResolving:s,termsError:null!==(t=o.getLastEntityRecordsError?.("taxonomy",l,r))&&void 0!==t?t:null}},[]),{options:E,descendantsById:b}=(0,i.useMemo)(()=>{if(!Array.isArray(f))return{options:[{label:(0,n.__)("All","toutefois"),value:""}],descendantsById:new Map};const e=new Map;f.forEach(t=>{const o=e.get(t.parent||0)||[];o.push(t),e.set(t.parent||0,o)});const t=[{label:(0,n.__)("All","toutefois"),value:""}],o=new Map,r=(s=0,i=0)=>{(e.get(s)||[]).sort((e,t)=>e.name.localeCompare(t.name,void 0,{sensitivity:"base"})).forEach(s=>{t.push({label:d(s.name,i),value:String(s.id)});const n=[s.id],a=new Set([s.id]);for(;n.length;){const t=n.pop();(e.get(t)||[]).forEach(e=>{a.has(e.id)||(a.add(e.id),n.push(e.id))})}o.set(s.id,Array.from(a)),r(s.id,i+1)})};return r(0,0),{options:t,descendantsById:o}},[f]),v=(0,i.useMemo)(()=>{if(y)return m&&b.get(y)||[y]},[y,m,b]),h=(0,i.useMemo)(()=>{const e={per_page:6,_embed:!0,_fields:"id,slug,title.rendered,featured_media,_embedded.wp:featuredmedia.media_details.sizes",orderby:"date",order:"desc",status:"publish",context:"view"};return v&&(e.categories=v),e},[v]),{posts:R,postsIsResolving:C,postsError:A}=(0,s.useSelect)(e=>{var t;const o=e("core"),r=e("core/data").isResolving("core","getEntityRecords",["postType",a,h]);return{posts:o.getEntityRecords("postType",a,h),postsIsResolving:r,postsError:null!==(t=o.getLastEntityRecordsError?.("postType",a,h))&&void 0!==t?t:null}},[h]);return(0,t.createElement)(t.Fragment,null,(0,t.createElement)(o.InspectorControls,null,(0,t.createElement)(r.PanelBody,{title:(0,n.__)("Projects Row Settings","toutefois"),initialOpen:!0},(0,t.createElement)(r.SelectControl,{label:(0,n.__)("Category","toutefois"),value:u||"",options:E,onChange:e=>c({category:e}),help:(0,n.__)("Filters by WordPress “Categories”.","toutefois")}),(0,t.createElement)(r.ToggleControl,{label:(0,n.__)("Include child categories in preview","toutefois"),checked:m,onChange:g}),(0,t.createElement)(r.TextControl,{label:(0,n.__)("Title","toutefois"),value:p||"",onChange:e=>c({title:e})}))),(0,t.createElement)("div",{className:"toutefois-projects-row__preview",style:{display:"grid",gap:12,gridTemplateColumns:"repeat(auto-fill, minmax(180px, 1fr))"}},(_||C)&&(0,t.createElement)(r.Spinner,null),w&&(0,t.createElement)(r.Notice,{status:"error",isDismissible:!1},(0,n.__)("Failed to load categories.","toutefois")),A&&(0,t.createElement)(r.Notice,{status:"error",isDismissible:!1},(0,n.__)("Failed to load projects.","toutefois")),!_&&!C&&Array.isArray(R)&&0===R.length&&(0,t.createElement)(r.Notice,{status:"info",isDismissible:!1},(0,n.__)("No projects found for this selection.","toutefois")),!C&&Array.isArray(R)&&R.map(e=>{const o=(e=>{const t=e?._embedded?.["wp:featuredmedia"]?.[0]?.media_details?.sizes||null;return t?.medium_large?.source_url||t?.medium?.source_url||t?.thumbnail?.source_url||null})(e);return(0,t.createElement)("div",{key:e.id,style:{border:"1px solid #ddd",borderRadius:8,overflow:"hidden",background:"#fff"}},o?(0,t.createElement)("img",{src:o,alt:"",style:{width:"100%",display:"block",aspectRatio:"16 / 9",objectFit:"cover"},loading:"lazy",decoding:"async"}):(0,t.createElement)("div",{style:{background:"#f2f2f2",width:"100%",aspectRatio:"16 / 9"}}),(0,t.createElement)("div",{style:{padding:10}},(0,t.createElement)("strong",{style:{display:"block",marginBottom:6}},e.title?.rendered||(0,n.__)("(No title)","toutefois"))))})))},save:function(){return null}})})();